/* 2.0list查询配色 */
:root {
    /* 例子，gray-2a代表，基于gray-2增加5%明度 */
    --orca-color-gray-2a: hsl(0deg 0% 90%);
    --orca-color-gray-3a: hsl(0deg 0% 80%);
    --orca-color-gray-6a: hsl(0deg 0% 40%);
    --orca-color-gray-5a: hsl(0deg 0% 55%);
    --orca-color-gray-4a: hsl(0deg 0% 70%);
    --orca-color-gray-7a: hsl(0deg 0% 30%);
    --my-size-query-block-breadcrumb: .8rem;
}

@media (prefers-color-scheme: dark) {
    :root {
        --my-bordercolor-query-list: var(--orca-color-gray-8);
        --my-color-query-list-breadcrumb: var(--orca-color-gray-6a);
        --my-color-query-list-id: var(--orca-color-gray-7a);
    }
}

@media (prefers-color-scheme: light) {
    :root {
        --my-bordercolor-query-list: var(--orca-color-gray-2a);
        --my-color-query-list-breadcrumb: var(--orca-color-gray-4a);
        --my-color-query-list-id: var(--orca-color-gray-3a);
    }
}

/* 通用 */
#custom-theme-body {

    /* 查询块面包屑尺寸缩小一点 */
    :is(.orca-query-card-breadcrumb, .orca-query-list-block-breadcrumb) {
        color: var(--my-color-query-list-breadcrumb);

        &>:is(.orca-breadcrumb-sep, .orca-block-breadcrumb-segment) {
            line-height: var(--orca-lineheight-md);
            font-size: var(--my-size-query-block-breadcrumb);
        }
    }
}

/* list视图 */
#custom-theme-body {
    .orca-query-list {
        counter-reset: result-id 0;

        &>.orca-query-list-block {
            counter-increment: result-id;
            --my-border-query-list: 1px;
            --my-border-left-query-list: 5px;
            --my-height-orca-repr-main-after: .35rem;
        }
    }


    /* 【移除】移除条目原本的背景板 */
    .orca-query-list-block::before {
        display: none;
    }

    .orca-query-list-block-block {
        isolation: isolate;
    }

    /* 【重定义】结果内的块内容不再需要那么大的左侧留白 */
    .orca-query-list-block-block {
        padding-left: 3px;
        /* 额外补一个left边框线的宽度 */
        margin-left: calc(var(--orca-spacing-indent) + var(--my-border-left-query-list));
    }

    /* 【新增】块内容背景板 */
    .orca-query-list-block-block:before {
        content: "";
        position: absolute;
        /* top补偿，after高度 + 边框 */
        top: calc(-1 * var(--my-height-orca-repr-main-after) - var(--my-border-query-list));
        /* bottom 补偿 边框 */
        bottom: var(--my-border-query-list);
        /* 拉开开一个缩进+边框的距离 */
        left: calc(-1 * var(--orca-spacing-indent) - var(--my-border-left-query-list));
        right: 0;
        background-color: #80808006;
        z-index: -1;
        border: var(--my-border-query-list) solid var(--my-bordercolor-query-list);
        border-left-width: var(--my-border-left-query-list);
        border-top-left-radius: 6px;
        border-bottom-left-radius: 6px;
    }

    .orca-query-list-block-breadcrumb {
        /* 值margin-bottom == after + border-top */
        margin-bottom: calc(var(--my-height-orca-repr-main-after) + var(--my-border-query-list));
        /* 移动半个字 使得刚好错开块标 */
        margin-left: -.5em;
    }

    /* 间距 */
    .orca-query-list-block {
        padding-top: 0;
        padding-bottom: 0;
        margin-top: 0;
        margin-bottom: 0;
        /* orca-block的背景板对照main:after进行了top扩充 var(--my-height-orca-repr-main-after) + border1px */
        /* 因此条目间距需要补上这个距离 */
        /* 再为了使条目间距 == border到文字底部的距离，额外补偿一个main:after和半行距 */
        margin-bottom: calc(var(--my-height-orca-repr-main-after) + var(--my-border-query-list) + 1 * (var(--my-height-orca-repr-main-after) + .3rem));

        &:has(+.orca-query-list-block>.orca-query-list-block-breadcrumb) {
            /* 后一个存在面包屑，有了明确实体，条目间距也就不需要替背景板补margin了*/
            /* 削去字间距，补偿border宽度使其看起来像是等距 */
            margin-bottom: calc(var(--my-height-orca-repr-main-after) + .3rem - var(--my-size-query-block-breadcrumb) * .3 + var(--my-border-query-list) * 2);
        }
    }

    /* —————————————————————————————————————————— */
    /* 使得工具条上俩间距一致 */
    .orca-query-result-list-toolbar {
        margin-bottom: 0;
    }

    .orca-query-list-block:first-child {
        margin-top: calc(var(--orca-spacing-md) - var(--my-size-query-block-breadcrumb) * .3);

        &:not(:has(>.orca-query-list-block-breadcrumb)) {
            margin-top: calc(var(--orca-spacing-md) + var(--my-height-orca-repr-main-after) + var(--my-border-query-list))
        }
    }

    /* —————————————————————————————————————————— */
    /* 计数器 */
    .orca-query-list-block-block>.orca-repr:after {
        content: counter(result-id);
        position: absolute;
        top: calc((var(--orca-block-line-height) * .5 - 5px));
        left: calc(-2 * var(--orca-spacing-indent));
        /* 用来支持text-align，顺便起到微调距离的作用 */
        width: 17px;
        font-size: 10px;
        line-height: 1;
        white-space: nowrap;
        color: var(--my-color-query-list-id);
        text-align: right;
    }

    .orca-query-list-block-block[data-editable=false]>.orca-repr:after {
        /* 不可编辑块存在--orca-spacing-md的padding用来放置按钮，因此要额外补一点 */
        top: calc((var(--orca-block-line-height) * .5 - 5px + var(--orca-spacing-md)));
    }


    .orca-query-list-block-block>.orca-repr>.orca-repr-main .orca-block-folding-handle {
        bottom: 0;
        /* 把handle的padding补回去以完全水平对齐内容 */
        top: 0;
        /* 垂直对齐 */
        padding-top: calc((var(--orca-block-line-height) * .5 - 8px));
        padding-bottom: 0;
        padding-left: 0;
        /* 默认3px */
        padding-right: .1875rem;

        /* 新的第一级折叠按钮 */
        &:before {
            content: "\f624";
            background-color: var(--orca-color-bg-1);
            border-radius: 999px;
            line-height: 1;
            font-size: 16px;
        }

        &.ti-caret-down-filled:before {
            rotate: 90deg;
        }
    }


    /* 对于查询结果，只要整个结果还在hover，就始终保持第一个块的折叠按钮显示 */
    /* 虎鲸自身的css，需要覆盖一下，从而优化折叠列表显示 */
    .orca-repr-main:not(:hover) .orca-block-folding-handle {
        opacity: 0;
    }

    .orca-query-list-block:hover>.orca-block>div>.orca-repr-main>.orca-repr-main-none-editable>.orca-block-folding-handle {
        opacity: 1;
    }
}

/* card视图 */
#custom-theme-body {

    /* 卡片视图里行卡片数文本移除左边距 和icon贴近点 */
    .orca-query-result-card-toolbar>div>.orca-button.plain.orca-select-button {
        padding-left: 0;
    }

    /* 行卡片数不需要自动换行 */
    .orca-query-result-card-toolbar>div:has(>.orca-select-button) {
        white-space: nowrap;
    }
}

/* 表格视图 */
/* 提供结果计数 */
#custom-theme-body {
    .orca-query-table-table {
        counter-reset: result-id 0;
    }

    .orca-query-table-row:not(.orca-query-table-row-add, .orca-query-table-row-stats) .orca-query-table-cell:first-child:before {
        --my-color-gray-1: hsl(0 0% 85% / 1);
        counter-increment: result-id;
        content: counter(result-id);
        width: 1.5em;
        height: 1em;
        line-height: 1;
        font-size: .6125rem;
        font-family: var(--orca-fontfamily-code);
        white-space: nowrap;

        position: absolute;
        z-index: 3;
        left: 0;
        top: 0;

        background-color: var(--orca-color-border);
        border-bottom-right-radius: 1em;
        border: 1px solid var(--orca-color-border);
        border-right-width: .5em;
        box-sizing: content-box;
        text-align: center;
        opacity: .3;
    }

    /* 对齐header第一栏的icon */
    .orca-table-header-cell:first-child {
        padding-left: 1.125em;

        &>.orca-table-header-cell-icon {
            padding-right: .25em;
        }
    }

    /* 表头第一个单元格模糊背景 */
    .orca-table-header-cell {
        background-color: rgb(from var(--orca-color-bg-2) r g b / .4);

        /* 模糊背景 */
        &:first-child {
            backdrop-filter: blur(1em);
        }

        /* header第一个cell缺少了圆角设置，且因为是定位元素，因此会影响边框线，得提供一个圆角 */
        &:first-child {
            border-top-left-radius: var(--orca-radius-sm);
        }

        &:first-child:last-child {
            border-top-right-radius: var(--orca-radius-sm);
        }
    }

    .orca-query-table-table {
        box-shadow: none;
        border-left-width: .5px;
        border-right-width: .5px;
    }

    .orca-table-resizer {
        background: center top / .5px 100% linear-gradient(var(--orca-color-separator), var(--orca-color-separator)) no-repeat;
    }
}