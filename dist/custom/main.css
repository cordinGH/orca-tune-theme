@keyframes tovisible {
    from {
        opacity: 0;
        scale: .95;
    }

    to {
        opacity: 1;
        scale: 1;
    }
}

@scope(#main) to (.orca-popup) {

    /* ———————————————————————————————————————————————————————————————————————————————————————————— */
    /* 压缩编辑器的最小左侧留白 */
    .orca-block-editor {
        grid-template-columns: minmax(calc(var(--orca-spacing-block) - .5rem), 1fr) [editor-start] minmax(var(--orca-editor-min-width, 0), var(--orca-editor-max-width)) [editor-end post-start] minmax(var(--orca-spacing-block), 1fr) [post-end];
    }

    .orca-panel {
        min-width: 453px !important;
    }

    /* 优化高亮框尺寸 */
    .orca-block-highlighter {
        left: -40px !important;
        width: unset !important;
        right: -0.5rem;
    }


    /* ***********************  面板左侧的折叠按钮非active非hover时变为小圆点   *********************** */
    /* 2025-10-07 简化圆点的实现方案以及样式 */
    /* 让工具条按钮padding和抓手padding一致，并稍微缩小一点 */
    .orca-block-editor-sidetools-btn.orca-button {
        padding: var(--orca-spacing-sm) var(--orca-spacing-2xs);

        /* 这几个按钮视觉上比抓手大，微调小点 */
        &>i {
            transform-origin: center;
            transform: scale(.9);
        }
    }
    /* 定位对齐也和抓手按钮一致 */
    .orca-block-editor-sidetools {
        right: calc(var(--orca-spacing-lg) + var(--orca-spacing-sm));
    }

    .orca-block-editor-sidetools-btn.orca-button{
        transition:all .15s ease-out;
    }

    /* 当悬停在非官方按钮上时生效，当没有悬停在侧边工具栏时也生效 */
    .orca-panel:not(.active)  .orca-block-editor-sidetools:is(:not(:hover), :has(.orca-block-editor-sidetools-btn:nth-child(n + 5):hover)) .orca-block-editor-sidetools-btn.orca-button:nth-child(-n + 4){
        scale: .3;
        transform-origin:top;
        margin-bottom: -85%;
        &:nth-child(4){
            margin-bottom: -75%;
        }
        &>i{
            background-color:var(--orca-color-text-1);
            color:transparent;
            border-radius:999px;
            transition:all .15s ease-out;
        }
    }

    /* 给面板抓手补个透明过渡 */
    .orca-panel-drag-handle {
        transition: opacity .15s ease-out;
    }

    .orca-panel-drag-handle.ti-dots-vertical {
        cursor: pointer;
        &::before{
            content: "\ec01";
        }
    }

    /* ———————————————————————————————————————————————————————————————————————————————————————————————————————————————— */
    /* 底部引用特定情况下去除：无计数器则none（虎鲸引用计数器是瞬时响应的） */
    /* 2025-09-14 issue-1。fix->存在包含结构时不作处理 */
    .orca-block-editor-blocks:not(:has(>.orca-block[data-indent="0"]>.orca-repr>.orca-repr-main :is(.orca-block-ref-count-marker, .orca-repr-tag-hierarchy)))+div:has(.orca-selected:first-child) {
        & .orca-hideable {
            display: none;
        }

        & .orca-block-editor-query-tabs-container {
            transition: opacity .15s ease-out .15s;
            opacity: .5;
        }

        & .orca-block-editor-query-tabs-container:hover {
            opacity: 1;
            transition: opacity .1s ease-out 0s;
        }
    }


    /* ———————————————————————————————————————————————————————————————————————————————————————————————————————————————— */
    /* 分屏分割线淡化 */
    .orca-panels-row>:is(.orca-panels-column, .orca-panel):not(:last-child),
    .orca-panels-column>:is(.orca-panels-row, .orca-panel):not(:last-child) {
        border-width: .5px;
    }

    /* ———————————————————————————————————————————————————————————————————————————————————————————————————————————————— */
    /* 编辑器切换时增加过渡动画 */
    .orca-hideable:not(.orca-hideable-hidden)>.orca-block-editor>.orca-block-editor-main {
        transform-origin: top left;
        animation: tovisible .1s linear backwards;
    }

    @keyframes tovisible {
        from {
            opacity: 0;
            scale: .95;
        }
    }
}



/* ———————————————————————————————————————————————————————————————————————————————————————————————————————————————— */
/* 
    1. 回调main编辑器-1缩进（非长文）
    2. 不处理查询 table 和 quote，因为不会存在子块。
*/
/* 顶层块容器整个左拉一个缩进距离以维持宽度不变 */
@media (prefers-color-scheme: dark) {
    :root {
        /* 顶层块缩进线 */
        --my-color-scope-line: var(--orca-color-gray-8);
        --my-color-scope-line: var(--orca-color-gray-5);
    }
}

@media (prefers-color-scheme: light) {
    :root {
        --my-color-scope-line: hsl(0 0% 90%);
        --my-color-scope-line: var(--orca-color-gray-5);
    }
}


/* 和次级块同缩进，并回拽一个缩进 */
@scope(#main) to (.orca-long-form, .orca-popup) {

    /* 回拽一个缩进 */
    .orca-block-editor-blocks>[data-indent="0"]:has(>.orca-repr:not(.orca-repr-table2, .orca-repr-quote2)) {
        margin-left: calc(-1 * var(--orca-spacing-indent));
    }

    /* 顶层块处理 */
    .orca-block-editor-blocks>[data-indent="0"]>.orca-repr:not(.orca-repr-table2, .orca-repr-quote2)>.orca-repr-main {

        /* 顶层块减少一个缩进 */
        &>:is(.orca-repr-main-content, .orca-repr-main-none-editable) {
            margin-left: var(--orca-spacing-indent) !important;
        }

        /* 折叠按钮和块标 */
        &>.orca-repr-main-none-editable>i {
            transform: translateX(var(--orca-spacing-indent));
        }

        /* 顶层块缩进线往上拉开一定距离 */
        &>.orca-repr-main-none-editable>.orca-repr-scope-line {
            top: calc(var(--orca-block-line-height) * .5 - 1px) !important;
        }

        /* 绘制拐弯缩进线样式 */
        &>.orca-repr-main-none-editable>.orca-repr-scope-line:before {
            width: calc(var(--orca-spacing-indent) - 6px);
            pointer-events: none;
            border-top: .5px dotted var(--my-color-scope-line);
            border-left-color: var(--my-color-scope-line);
            border-left-style: dotted;
            border-left-width: .5px;
            border-top-left-radius: 10px;
            opacity: .1;
        }

        /* 更改缩进线的hover变色逻辑，改用边框 */
        &>.orca-repr-main-none-editable>.orca-repr-scope-line:hover {
            background-color: unset;
        }

        &>.orca-repr-main-none-editable>.orca-repr-scope-line:hover:before {
            border-width: 3px;
            border-left-style: solid;
            border-top-style: solid;
        }

    }

    /* fixed|适配1.31版本的css变更：orca-block增加新属性data-editable="false"，因为需要存放插入行按钮，所以额外加了margin */
    .orca-block-editor-blocks>[data-indent="0"][data-editable="false"]:not([data-type="journal"])>.orca-repr:not(.orca-repr-table2, .orca-repr-quote2)>.orca-repr-main>.orca-repr-main-none-editable>.orca-repr-scope-line {
        top: calc(var(--orca-block-line-height) * .5 - 1px + var(--orca-spacing-md)) !important;
    }

}

/* 文本类型块聚焦放大字体，但是排除弹出框和模态层 */
/* 2. 文本类型块-1块，标题级字体大小 */
@scope(#main) to (.orca-popup) {
    .orca-block-editor-blocks>[data-indent="0"]>:is(.orca-repr-text, .orca-repr-ul, .orca-repr-ol, .orca-repr-task, .orca-repr-heading)>.orca-repr-main>.orca-repr-main-content {

        /* 继承原生h1字号日志块字号风格 */
        font-size: var(--orca-fontsize-2xl);
        /* 沿用日志顶层块的前后边距 */
        margin: var(--orca-spacing-md) 0;

        /* 取消自定义样式文本样式的大号字体 */
        & .orca-inline.f {
            font-size: inherit;
        }
    }
}

/* ———————————————————————————————————————————————————————————————————————————————————————————————————————————————— */
/* ctrl tab 编辑器列表的关闭按钮扔前面，方便操作 */
.orca-recents-menu-item>.orca-recents-menu-close {
    order: -1;
    padding: .125rem;
    margin-right: .25rem;
    margin-left: -.25rem;
    transition-duration: .1s;
}

.orca-recents-menu-item:not(:hover)>.orca-recents-menu-close {
    opacity: 0.1;
}

.orca-recents-menu-item:hover>.orca-recents-menu-close:not(:hover) {
    opacity: .3;
}

/* 编辑器列表条目前缀块标 */
.orca-menu-text-pre {
    margin-right: .5rem;
}


/* ———————————————————————————————————————————————————————————————————————————————————————————————————————————————— */
/* TOC顶格缩进；块标调节 */
.orca-toc>.orca-toc-item>.orca-toc-item-content {
    &>.orca-toc-item-fold-arrow:before {
        content: "\ea08";
    }

    margin-bottom:.375rem;

    &:has(>.ti-chevron-right) {
        border-radius: 4px;
        padding-left: .375rem;
        margin-left: -.375rem;
        background-image: linear-gradient(to right, rgb(128 128 128 / 12%) 50%, transparent);
    }
}

.orca-toc>.orca-toc-item>.orca-toc-item-child-items {
    margin-left: 0em;
}