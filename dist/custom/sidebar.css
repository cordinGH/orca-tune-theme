
/* 
    ————————————————————————————————————————————————————————————————————————————————

    1. 左侧边栏折叠按钮融合块标并提供缩进线
    2. 折叠时提供一个圆角小竖条作为状态告知

    ————————————————————————————————————————————————————————————————————————————————
*/

/* ==================== 创建层级指示条  并优化悬停时的背景色=================== */
/* ======================  2025-12-19 优化版本 ======================== */
.orca-aliased-block,
.orca-tags-tag,
.orca-fav-item:not(.plugin-tabsman-panel-group){
    position: relative;
    anchor-scope:--item-row-area;
}    

/* 层级指示条的列位置锚点 */
.orca-aliased-block>[draggable="true"]>div { anchor-name: --item-row-area; }
.orca-tags-tag>[draggable="true"]>div { anchor-name: --item-row-area; }
.orca-fav-item:not(.plugin-tabsman-panel-group)>.orca-fav-item-item>div { anchor-name: --item-row-area }


/* 层级指示条（折叠|常态）（⭐️⭐️⭐️已适配tabsman插件） */
.orca-aliased-block:has(>.orca-aliased-block-item>:is(.ti-chevron-down, .ti-chevron-right)):before,
.orca-tags-tag:has(>.orca-tags-tag-item>:is(.ti-chevron-down, .ti-chevron-right)):before,
.orca-fav-item:not(.plugin-tabsman-panel-group):has(>.orca-fav-item-item>:is(.ti-chevron-down, .ti-chevron-right)):before {
    content: "";
    pointer-events: none;
    position: absolute;
    position-anchor: --item-row-area;
    top: 9px;
    height: 15px;
    left: calc(anchor(left) - 6px);
    width: 2px;
    background-color: var(--orca-color-text-1);
    opacity: .6;
    border-radius: 1px;

    /* 宽度背景色不需要过渡，不然很奇怪，有一个很大的折叠区块*/
    transition-property: height, top, opacity, border-radius, box-shadow;
    transition-duration: .2s;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
}

/* 指示条展开变成缩进线（⭐️⭐️⭐️已适配tabsman插件） */
.orca-aliased-block:has(>.orca-aliased-block-item>.ti-chevron-down):before,
.orca-tags-tag:has(>.orca-tags-tag-item>.ti-chevron-down):before,
.orca-fav-item:not(.plugin-tabsman-panel-group):has(>.orca-fav-item-item>.ti-chevron-down):before {
    top: 15px;
    height: calc(100% - 15px);
    width: 6px;
    background-color:transparent;
    border-top-left-radius: 999px;
    border-bottom-left-radius: 999px;
    /* 用box-shadow模拟border，从而以规避border的幽灵线 */
    box-shadow: -.5px 0 0 0 var(--orca-color-text-1);
}

/* 缩进线形态的颜色透明度（⭐️⭐️⭐️已适配tabsman插件） */
.orca-aliased-block:has(>.orca-aliased-block-item>.ti-chevron-down):before,
.orca-tags-tag:has(>.orca-tags-tag-item>.ti-chevron-down):before,
.orca-fav-item:not(.plugin-tabsman-panel-group):has(>.orca-fav-item-item>.ti-chevron-down):before {
    opacity: .4;
}
.orca-aliased-block:has(>.orca-aliased-block-item>.ti-chevron-down):hover:before,
.orca-tags-tag:has(>.orca-tags-tag-item>.ti-chevron-down):hover:before,
.orca-fav-item:not(.plugin-tabsman-panel-group):has(>.orca-fav-item-item>.ti-chevron-down):hover:before {
    opacity: .8;
}
@media (prefers-color-scheme: dark) {
    .orca-aliased-block:has(>.orca-aliased-block-item>.ti-chevron-down):before,
    .orca-tags-tag:has(>.orca-tags-tag-item>.ti-chevron-down):before,
    .orca-fav-item:not(.plugin-tabsman-panel-group):has(>.orca-fav-item-item>.ti-chevron-down):before {
        opacity: .3125;
    }
    .orca-aliased-block:has(>.orca-aliased-block-item>.ti-chevron-down):hover:before,
    .orca-tags-tag:has(>.orca-tags-tag-item>.ti-chevron-down):hover:before,
    .orca-fav-item:not(.plugin-tabsman-panel-group):has(>.orca-fav-item-item>.ti-chevron-down):hover:before {
        opacity: .625;
    }
}


/* 虎鲸的悬停背景色是在item上的，这会遮挡缩进线，也不能直接让item负数zindex沉下去，这会导致不触发hover判定 */
/* 相对来说最优解还得是基于伪元素重新绘制一份，让这个伪元素zindex沉下去。 */
/* ⭐️⭐️⭐️已适配tabsman插件 */
.orca-aliased-block-item:hover,
.orca-tags-tag-item:hover,
.orca-fav-item-item:not(.plugin-tabsman-item-item):hover {
    background-color: unset!important;
}

/* 重新绘制一个背景色，不然会遮挡父级缩进线（⭐️⭐️⭐️已适配tabsman插件） */
/* 没有后代被hover，则表示当前选中块，稍微提亮一些 */
.orca-aliased-block:hover:after,
.orca-tags-tag:hover:after,
.orca-fav-item:not(.plugin-tabsman-panel-group):hover:after{
    pointer-events: none;
    content: "";
    position: absolute;
    top: 1px;
    height: 31px;
    left: 0;
    right: 0;
    z-index: -1;
    background-color: var(--orca-color-gray-5);
    opacity: .2;
    border-radius: var(--orca-radius-sm);
}
.orca-aliased-block:not(:has(>.orca-aliased-block:hover)):after,
.orca-tags-tag:not(:has(>.orca-tags-tag:hover)):after,
.orca-fav-item:not(.plugin-tabsman-panel-group):not(:has(>.orca-fav-item:hover)):after{
    opacity: .35;
}

/* ======================================================================================== */



/* =================================== 融合折叠按钮和块标 ===================================== */

/* 为左侧栏条目配备缩进线 */
/* ⭐️⭐️⭐️已适配tabsman插件 */
.orca-fav-item-item:not(.plugin-tabsman-item-item) {
    /* 合并折叠按钮和块图标 */
    grid-template-columns: 0px auto 1fr auto;
    /* 延续虎鲸的设计，通过border拉开一点边距 */
    border-left-width: 11px;
}

/* tag和别名要多一个计数器栏 */
.orca-tags-tag-item,
.orca-aliased-block-item {
    grid-template-columns: 0 auto auto minmax(max-content, 1fr) auto;
    border-left-width: 11px;
}

/* 折叠按钮和块标重叠化 */
/* 处理第一个按钮同步块标按钮22px尺寸，从而精准对齐块标icon，使得hover时显示出来以偷取fav-icon背景色 */
.orca-aliased-block-item :is(.ti-chevron-right, .ti-chevron-down),
.orca-tags-tag-item :is(.ti-chevron-right, .ti-chevron-down),
.orca-fav-item-item:not(.plugin-tabsman-item-item) :is(.ti-chevron-right, .ti-chevron-down) {
    /* 叠到块标上面 */
    position: relative;
    opacity: 0;
    width: 22px;
    /* 垂直对齐 */
    line-height: 22px;
    text-align: center;
    transition: opacity 0.1s cubic-bezier(0.5, 0, 1, 1) 0s;

    /* 扩大折叠按钮显示区域 */
    &:after {
        content: "";
        position: absolute;
        display: block;
        top: -4px;
        bottom: -4px;
        left: -8px;
        width: 36px;
    }
}

/* 进入hover时 等块标消失了再显示折叠图标 */
.orca-aliased-block-item:hover>:is(.ti-chevron-right, .ti-chevron-down),
.orca-tags-tag-item:hover>:is(.ti-chevron-right, .ti-chevron-down),
.orca-fav-item-item:not(.plugin-tabsman-item-item):hover>:is(.ti-chevron-right, .ti-chevron-down) {
    opacity: 1;
    transition: opacity 0.1s cubic-bezier(0, 0, 0.2, 1) 0.1s;
}

/* 退出hover时，等待折叠图标消失了再显现块标 */
.orca-aliased-block-item:has( :is(.ti-chevron-right, .ti-chevron-down)) :is(.orca-aliased-block-icon, .orca-aliased-block-icon-emoji),
.orca-tags-tag-item:has( :is(.ti-chevron-right, .ti-chevron-down)) .orca-tags-tag-icon,
.orca-fav-item-item:not(.plugin-tabsman-item-item):has( :is(.ti-chevron-right, .ti-chevron-down)) .orca-fav-item-icon {
    /* 可折叠的条目不需要旋转放大的动画 */
    animation: unset;

    /* 等待箭头消失了再恢复 */
    transition: color 0.1s cubic-bezier(0, 0, 0.2, 1) 0.1s;
}

/* hover时，块标立马透明，让折叠图标显现出来 */
.orca-aliased-block-item:has( :is(.ti-chevron-right, .ti-chevron-down)):hover :is(.orca-aliased-block-icon, .orca-aliased-block-icon-emoji),
.orca-tags-tag-item:has( :is(.ti-chevron-right, .ti-chevron-down)):hover .orca-tags-tag-icon,
.orca-fav-item-item:not(.plugin-tabsman-item-item):has( :is(.ti-chevron-right, .ti-chevron-down)):hover .orca-fav-item-icon {
    /* hover时透明掉color，让折叠按钮露出来，并穿透 */
    color: transparent !important;
    pointer-events: none;
    transition: color 0.1s cubic-bezier(0.5, 0, 1, 1) 0s;
}

/* ======================================================================================== */


.orca-favorites-items,
.orca-tags-list-list,
.orca-aliased-list {
    padding-right: .375rem;
}


/* 2025-09-19，优化侧边栏收起/展开的过渡，使得main区域平滑变化 */
#sidebar{
    position: relative !important;
    /* devtools预设的曲线 */
    transition:margin-left 0.1s cubic-bezier(0.22, 0.61, 0.36, 1) !important;
    
}

/* 2025-10-13 orca-sidebar-width包括了padding和边框 */
.sidebar-closed #sidebar{
    width:var(--orca-sidebar-width);
    /* 补上main的6px外边距 */
    margin-left:calc(-1 * var(--orca-sidebar-width) + 6px);
}


/* 2026年1月5日虎鲸1.58，折叠按钮新增了一个padding，导致侧边栏的层级指示器和按钮等元素尺寸错位。现取消。 */
.orca-aliased-block-fold, .orca-fav-item-fold, .orca-tags-tag-fold{
    padding:0
}
